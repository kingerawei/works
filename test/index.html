<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>获取目标页面动态生成的 pre 内容</title>
  <style>
    /* 隐藏 iframe（如果你不需要显示目标页面） */
    #targetFrame {
      width: 0;
      height: 0;
      border: 0;
      visibility: hidden;
    }
  </style>
</head>
<body>
  <h1>获取动态生成的 pre 内容</h1>
  <!-- 用 iframe 加载目标页面 -->
  <iframe id="targetFrame" src="http://www.drg.ip-ddns.com/api/grouper/drg/?X-API-KEY=bob-2ba5bd5527c1573652598a095495cec9cb6e0a64b4d817b68b3c8033109fc07e&Index=100&gender=1&age=20&ageDay=0&weight=0&inHospitalTime=10&leavingType=1&zdList=T79.300x001&ssMainList=&ssList="></iframe>
  <!-- 用于显示获取的结果 -->
  <div id="result">等待目标页面加载...</div>

  <script>
    // 获取 iframe 元素
    const iframe = document.getElementById("targetFrame");

    // 当 iframe 加载完成时触发 onload 事件
    iframe.onload = function () {
      try {
        // 尝试访问 iframe 内部的 document（必须满足同源策略，否则会报错）
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        console.log("目标页面已加载，开始轮询查找 <pre> 元素...");

        // 每 500ms 检查一次是否有 <pre> 元素，并且内容不为空
        const interval = setInterval(() => {
          const preElement = iframeDoc.querySelector("pre");
          if (preElement && preElement.innerText.trim() !== "") {
            clearInterval(interval);
            console.log("检测到 <pre> 元素内容：", preElement.innerText);
            // 将 pre 中的内容显示到当前页面的 result 中
            document.getElementById("result").innerText = preElement.innerText;
          }
        }, 500);

        // 如果超过 30 秒还未找到，则显示超时信息
        setTimeout(() => {
          clearInterval(interval);
          if (!iframeDoc.querySelector("pre") || iframeDoc.querySelector("pre").innerText.trim() === "") {
            document.getElementById("result").innerText = "等待超时，未找到 pre 数据";
          }
        }, 30000);
      } catch (error) {
        console.error("无法访问 iframe 内部内容，请检查同源策略：", error);
        document.getElementById("result").innerText = "无法访问目标页面内容（同源策略限制）。";
      }
    };
  </script>
</body>
</html>